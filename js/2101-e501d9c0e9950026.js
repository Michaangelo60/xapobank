"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2101],{2101:function(t,e,n){n.d(e,{Z:function(){return L}});var i,a=function(){return(a=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function o(t,e,n,i){return new(n||(n=Promise))(function(a,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function s(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?a(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(r,s)}l((i=i.apply(t,e||[])).next())})}function r(t,e){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=2&o[0]?i.return:o[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;switch(i=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,i=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(a=(a=r.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){r=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(6===o[0]&&r.label<a[1]){r.label=a[1],a=o;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(o);break}a[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],i=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var s=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;if(Array.isArray(e)){if((i=e.length)!=n.length)return!1;for(a=i;0!=a--;)if(!t(e[a],n[a]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((i=(o=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(a=i;0!=a--;)if(!Object.prototype.hasOwnProperty.call(n,o[a]))return!1;for(a=i;0!=a--;){var i,a,o,r=o[a];if(!t(e[r],n[r]))return!1}return!0}return e!=e&&n!=n};function l(t,e){var n=Object.keys(e||{}).filter(function(n){return!s(null==t?void 0:t[n],null==e?void 0:e[n])});return Object.keys(t||{}).filter(function(t){Object.keys(e||{}).includes(t)||n.push(t)}),Object.keys(n).length?n:null}function u(t,e,n){var i="shortString",a=!0;"number"==typeof n&&(i="javaDouble",a=!1),t[i]=t[i]||{},t[i][e]=a?n+"":n}function c(t){return!!t&&"object"==typeof t&&void 0!==t.value}function h(t){return Object.fromEntries(Object.entries(t).map(function(t){var e=t[0],n=t[1];return[e,c(n)?n:{value:n}]}))}function d(t){return a(a({},t),{identity:t.identity?a(a({},t.identity),{traits:h(t.identity.traits||{})}):void 0})}(v=g||(g={})).NONE="NONE",v.DEFAULT_FLAGS="DEFAULT_FLAGS",v.CACHE="CACHE",v.SERVER="SERVER";var v,g,f,p,y,m=null,S="FLAGSMITH_EVENT",C="https://edge.api.flagsmith.com/api/v1/",_=function(){function t(t){var e=this;this._trigger=null,this._triggerLoadingState=null,this.timestamp=null,this.isLoading=!1,this.eventSource=null,this.getFlags=function(){var t=e.api,n=e.evaluationContext;e.log("Get Flags"),e.isLoading=!0,e.loadingState.isFetching||e.setLoadingState(a(a({},e.loadingState),{isFetching:!0}));var i="".concat(e.getContext().identity),o=function(t){var n,o,r,s;if(t&&i==="".concat(e.getContext().identity)){var c=t.flags,h=t.traits,d=t.identifier;e.isLoading=!1;var v={},f={};h=h||[],(c=c||[]).forEach(function(t){v[t.feature.name.toLowerCase().replace(/ /g,"_")]={id:t.feature.id,enabled:t.enabled,value:t.feature_state_value}}),h.forEach(function(t){f[t.trait_key.toLowerCase().replace(/ /g,"_")]={transient:t.transient,value:t.trait_value}}),e.oldFlags=a({},e.flags);var p=l(e.oldFlags,v),y=l(null===(n=e.evaluationContext.identity)||void 0===n?void 0:n.traits,f);if((d||Object.keys(f).length)&&(e.evaluationContext.identity=a(a({},e.evaluationContext.identity),{traits:f}),d&&(e.evaluationContext.identity.identifier=d,e.identity=d)),e.flags=v,e.updateStorage(),e._onChange(e.oldFlags,{isFromServer:!0,flagsChanged:p,traitsChanged:y},e._loadedState(null,g.SERVER)),e.datadogRum)try{if(e.datadogRum.trackTraits){var m={};Object.keys((null===(o=e.evaluationContext.identity)||void 0===o?void 0:o.traits)||{}).map(function(t){m["flagsmith_trait_"+t]=e.getTrait(t)});var S=a(a(a({},e.datadogRum.client.getUser()),{id:e.datadogRum.client.getUser().id||(null===(r=e.evaluationContext.identity)||void 0===r?void 0:r.identifier)}),m);e.log("Setting Datadog user",S),e.datadogRum.client.setUser(S)}}catch(t){console.error(t)}if(e.dtrum)try{var C={javaDouble:{},date:{},shortString:{},javaLongOrObject:{}};Object.keys(e.flags).map(function(t){u(C,"flagsmith_value_"+t,e.getValue(t,{skipAnalytics:!0})),u(C,"flagsmith_enabled_"+t,e.hasFeature(t,{skipAnalytics:!0}))}),Object.keys((null===(s=e.evaluationContext.identity)||void 0===s?void 0:s.traits)||{}).map(function(t){u(C,"flagsmith_trait_"+t,e.getTrait(t))}),e.log("Sending javaLongOrObject traits to dynatrace",C.javaLongOrObject),e.log("Sending date traits to dynatrace",C.date),e.log("Sending shortString traits to dynatrace",C.shortString),e.log("Sending javaDouble to dynatrace",C.javaDouble),e.dtrum.sendSessionProperties(C.javaLongOrObject,C.date,C.shortString,C.javaDouble)}catch(t){console.error(t)}}};return n.identity?Promise.all([n.identity.traits&&Object.keys(n.identity.traits).length||!n.identity.identifier?e.getJSON(t+"identities/","POST",JSON.stringify({identifier:n.identity.identifier,transient:n.identity.transient,traits:Object.entries(n.identity.traits).map(function(t){var e=t[0],n=t[1];return{trait_key:e,trait_value:null==n?void 0:n.value,transient:null==n?void 0:n.transient}}).filter(function(t){return void 0!==t.trait_value||(e.log("Warning - attempted to set an undefined trait value for key",t.trait_key),!1)})})):e.getJSON(t+"identities/?identifier="+encodeURIComponent(n.identity.identifier)+(n.identity.transient?"&transient=true":""))]).then(function(t){return e.evaluationContext.identity=a(a({},e.evaluationContext.identity),{traits:{}}),o(null==t?void 0:t[0])}).catch(function(t){return Promise.reject(Error(t.message))}):e.getJSON(t+"flags/").then(function(t){return o({flags:t,traits:void 0})})},this.analyticsFlags=function(){var t=e.api;if(e.evaluationEvent&&e.evaluationContext.environment&&e.evaluationEvent[e.evaluationContext.environment.apiKey])return e.evaluationEvent&&0!==Object.getOwnPropertyNames(e.evaluationEvent).length&&0!==Object.getOwnPropertyNames(e.evaluationEvent[e.evaluationContext.environment.apiKey]).length?e.getJSON(t+"analytics/flags/","POST",JSON.stringify(e.evaluationEvent[e.evaluationContext.environment.apiKey])).then(function(t){if(e.evaluationContext.environment){var n=e.getState();e.evaluationEvent||(e.evaluationEvent={}),e.evaluationEvent[e.evaluationContext.environment.apiKey]={},e.setState(a(a({},n),{evaluationEvent:e.evaluationEvent})),e.updateEventStorage()}}).catch(function(t){e.log("Exception fetching evaluationEvent",t)}):void 0},this.datadogRum=null,this.loadingState={isLoading:!0,isFetching:!0,error:null,source:g.NONE},this.canUseStorage=!1,this.analyticsInterval=null,this.api=null,this.cacheFlags=!1,this.enableAnalytics=!1,this.enableLogs=!1,this.evaluationContext={},this.evaluationEvent=null,this.flags=null,this.getFlagInterval=null,this.headers=null,this.identity=null,this.initialised=!1,this.oldFlags=null,this.onChange=null,this.onError=null,this.ticks=null,this.timer=null,this.dtrum=null,this.withTraits=null,this.cacheOptions={ttl:0,skipAPI:!1,loadStale:!1,storageKey:void 0},this.getValue=function(t,n,i){var a=e.flags&&e.flags[t.toLowerCase().replace(/ /g,"_")],o=null;if(a&&(o=a.value),(null==n?void 0:n.skipAnalytics)||i||e.evaluateFlag(t,"VALUE"),null===o&&void 0!==(null==n?void 0:n.fallback))return n.fallback;if(null==n?void 0:n.json)try{return null===o?(e.log("Tried to parse null flag as JSON: "+t),null):JSON.parse(o)}catch(t){return n.fallback}return o},this.getTrait=function(t){var n,i;return(null===(n=e.evaluationContext.identity)||void 0===n?void 0:n.traits)&&(null===(i=e.evaluationContext.identity.traits[t.toLowerCase().replace(/ /g,"_")])||void 0===i?void 0:i.value)},this.getAllTraits=function(){var t;return Object.fromEntries(Object.entries((null===(t=e.evaluationContext.identity)||void 0===t?void 0:t.traits)||{}).map(function(t){var e=t[0],n=t[1];return[e,null==n?void 0:n.value]}))},this.setContext=function(t){var n,i,o=d(t);return e.evaluationContext=a(a({},o),{environment:o.environment||e.evaluationContext.environment}),e.identity=null===(i=null===(n=e.getContext())||void 0===n?void 0:n.identity)||void 0===i?void 0:i.identifier,e.initialised?e.getFlags():Promise.resolve()},this.getContext=function(){return e.evaluationContext},this.updateContext=function(t){return e.setContext(a(a({},e.getContext()),t))},this.setTrait=function(t,n){var i;if(e.api)return e.setContext(a(a({},e.evaluationContext),{identity:a(a({},e.evaluationContext.identity),{traits:a(a({},null===(i=e.evaluationContext.identity)||void 0===i?void 0:i.traits),h(Object.fromEntries([[t,n]])))})}))},this.setTraits=function(t){var n;if(e.api)return e.setContext(a(a({},e.evaluationContext),{identity:a(a({},e.evaluationContext.identity),{traits:a(a({},null===(n=e.evaluationContext.identity)||void 0===n?void 0:n.traits),Object.fromEntries(Object.entries(t).map(function(t){var e=t[0],n=t[1];return[e,c(n)?n:{value:n}]})))})}));console.error("Attempted to setTraits a user before calling flagsmith.init. Call flagsmith.init first, if you wish to prevent it sending a request for flags, call init with preventFetch:true.")},this.hasFeature=function(t,n){var i="object"==typeof n,a=e.flags&&e.flags[t.toLowerCase().replace(/ /g,"_")],o=!1;return!a&&i&&void 0!==n.fallback?o=null==n?void 0:n.fallback:a&&a.enabled&&(o=!0),(!i||n.skipAnalytics)&&n||e.evaluateFlag(t,"ENABLED"),o},this.getStorageKey=function(){var t,n;return(null===(t=e.cacheOptions)||void 0===t?void 0:t.storageKey)||"FLAGSMITH_DB_"+(null===(n=e.evaluationContext.environment)||void 0===n?void 0:n.apiKey)},this.getJSON=function(t,n,i){var a,o,r,s=e.headers,l={method:n||"GET",body:i,cache:"no-cache",headers:{}};e.evaluationContext.environment&&(l.headers["X-Environment-Key"]=e.evaluationContext.environment.apiKey),n&&"GET"!==n&&(l.headers["Content-Type"]="application/json; charset=utf-8"),(null===(a=e.applicationMetadata)||void 0===a?void 0:a.name)&&(l.headers["Flagsmith-Application-Name"]=e.applicationMetadata.name),(null===(o=e.applicationMetadata)||void 0===o?void 0:o.version)&&(l.headers["Flagsmith-Application-Version"]=e.applicationMetadata.version),s&&Object.assign(l.headers,s),f||console.error("Flagsmith: fetch is undefined, please specify a fetch implementation into flagsmith.init to support SSR.");var u="".concat(null===(r=e.evaluationContext.identity)||void 0===r?void 0:r.identifier);return f(t,l).then(function(i){var a,o,r="".concat(null===(a=e.evaluationContext.identity)||void 0===a?void 0:a.identifier);if(u===r){var s=null===(o=i.headers)||void 0===o?void 0:o.get("x-flagsmith-document-updated-at");if(s)try{var l=parseFloat(s);if(isNaN(l))return Promise.reject("Failed to parse x-flagsmith-document-updated-at");e.timestamp=l}catch(t){e.log(t,"Failed to parse x-flagsmith-document-updated-at",s)}return e.log("Fetch response: "+i.status+" "+(n||"GET")+"0"+t),i.text().then(function(t){var e=t;try{e=JSON.parse(t)}catch(t){}return!e&&i.status&&(e="API Response: ".concat(i.status)),i.status&&i.status>=200&&i.status<300?e:Promise.reject(Error(e))})}e.log("Received response with identity mismatch, ignoring response. Requested: ".concat(u,", Current: ").concat(r))})},this.evaluateFlag=function(t,n){if(e.datadogRum&&(e.datadogRum.client.addFeatureFlagEvaluation?"VALUE"===n?e.datadogRum.client.addFeatureFlagEvaluation("flagsmith_value_"+t,e.getValue(t,{},!0)):e.datadogRum.client.addFeatureFlagEvaluation("flagsmith_enabled_"+t,e.hasFeature(t,!0)):console.error("Flagsmith: Your datadog RUM client does not support the function addFeatureFlagEvaluation, please update it.")),e.enableAnalytics){if(!e.evaluationEvent||!e.evaluationContext.environment)return;e.evaluationEvent[e.evaluationContext.environment.apiKey]||(e.evaluationEvent[e.evaluationContext.environment.apiKey]={}),void 0===e.evaluationEvent[e.evaluationContext.environment.apiKey][t]&&(e.evaluationEvent[e.evaluationContext.environment.apiKey][t]=0),e.evaluationEvent[e.evaluationContext.environment.apiKey][t]+=1}e.updateEventStorage()},this._onChange=function(t,n,i){var a,o;e.setLoadingState(i),null===(a=e.onChange)||void 0===a||a.call(e,t,n,e.loadingState),null===(o=e._trigger)||void 0===o||o.call(e)},f=t.fetch?t.fetch:"undefined"!=typeof fetch?fetch:null==global?void 0:global.fetch,this.canUseStorage="undefined"!=typeof window||!!t.browserlessStorage,this.applicationMetadata=t.applicationMetadata,this.log("Constructing flagsmith instance "+t),t.eventSource&&(p=t.eventSource),t.AsyncStorage&&(m=t.AsyncStorage)}return t.prototype.init=function(t){var e,n,i;return o(this,void 0,void 0,function(){var s,u,c,h,v,p,y,_,b,E,x,O,F,w,L,I,A,j,k,T,N,P,R,K,D,U,G,J,M,H,V,q,B,W=this;return r(this,function(X){switch(X.label){case 0:s=d(t.evaluationContext||this.evaluationContext),X.label=1;case 1:if(X.trys.push([1,13,,14]),u=t.environmentID,h=void 0===(c=t.api)?C:c,v=t.headers,p=t.onChange,y=t.cacheFlags,_=t.datadogRum,b=t.onError,E=t.defaultFlags,x=t.fetch,O=t.preventFetch,F=t.enableLogs,w=t.enableDynatrace,L=t.enableAnalytics,I=t.realtime,j=void 0===(A=t.eventSourceUrl)?"https://realtime.flagsmith.com/":A,k=t.AsyncStorage,T=t.identity,N=t.traits,P=t.state,R=t.cacheOptions,K=t.angularHttpClient,D=t._trigger,U=t._triggerLoadingState,G=t.applicationMetadata,s.environment=u?{apiKey:u}:s.environment,!s.environment||!s.environment.apiKey)throw Error("Please provide `evaluationContext.environment` with non-empty `apiKey`");if(s.identity=T||N?{identifier:T,traits:N?Object.fromEntries(Object.entries(N).map(function(t){return[t[0],{value:t[1]}]})):{}}:s.identity,this.evaluationContext=s,this.api=h.endsWith("/")?h:h+"/",this.headers=v,this.getFlagInterval=null,this.analyticsInterval=null,this.onChange=p,J="Wrong Flagsmith Configuration: preventFetch is true and no defaulFlags provided",this._trigger=D||this._trigger,this._triggerLoadingState=U||this._triggerLoadingState,this.onError=function(t){W.setLoadingState(a(a({},W.loadingState),{isFetching:!1,isLoading:!1,error:t})),null==b||b(t)},this.enableLogs=F||!1,this.cacheOptions=R?{skipAPI:!!R.skipAPI,ttl:R.ttl||0,storageKey:R.storageKey,loadStale:!!R.loadStale}:this.cacheOptions,!this.cacheOptions.ttl&&this.cacheOptions.skipAPI&&console.warn("Flagsmith: you have set a cache ttl of 0 and are skipping API calls, this means the API will not be hit unless you clear local storage."),x&&(f=x),this.enableAnalytics=L||!1,this.flags=Object.assign({},E)||{},this.datadogRum=_||null,this.initialised=!0,this.ticks=1e4,this.timer=this.enableLogs?(new Date).valueOf():null,this.cacheFlags=void 0!==m&&!!y,this.applicationMetadata=G,S="FLAGSMITH_EVENT_"+s.environment.apiKey,k&&(m=k),I&&"undefined"!=typeof window&&this.setupRealtime(j,s.environment.apiKey),Object.keys(this.flags).length&&(this.loadingState=a(a({},this.loadingState),{isLoading:!1,source:g.DEFAULT_FLAGS})),this.setState(P),this.log("Initialising with properties",t,this),w&&("undefined"==typeof dtrum?console.error("You have attempted to enable dynatrace but dtrum is undefined, please check you have the Dynatrace RUM JavaScript API installed."):this.dtrum=dtrum),K&&(f=function(t,e){var n=e.headers,i=e.method,a=e.body;return new Promise(function(e){switch(i){case"GET":return K.get(t,{headers:n}).subscribe(function(t){e({ok:!0,text:function(){return Promise.resolve(t)}})});case"POST":case"PUT":return K.post(t,a,{headers:n}).subscribe(function(t){e({ok:!0,text:function(){return Promise.resolve(t)}})})}})}),m&&this.canUseStorage&&m.getItem(S).then(function(t){try{W.evaluationEvent=JSON.parse(t)||{}}catch(t){W.evaluationEvent={}}W.analyticsInterval=setInterval(W.analyticsFlags,W.ticks)}),this.enableAnalytics&&(this.analyticsInterval&&clearInterval(this.analyticsInterval),m&&this.canUseStorage&&m.getItem(S,function(t,e){if(e&&W.evaluationContext.environment){var n=JSON.parse(e);if(n[W.evaluationContext.environment.apiKey]){var i=W.getState();W.log("Retrieved events from cache",e),W.setState(a(a({},i),{evaluationEvent:n[W.evaluationContext.environment.apiKey]}))}}})),!y)return[3,9];if(!m||!this.canUseStorage)return[3,8];M=function(t,e){return o(W,void 0,void 0,function(){var t,n,i,o,s,u,c,h,v,f,p,y,m,S,C,_,b,x,F,w=this;return r(this,function(r){switch(r.label){case 0:if(!e)return[3,7];t=null,n=null,r.label=1;case 1:return r.trys.push([1,5,,6]),i=JSON.parse(e),o=!1,s=!1,i&&i.api===this.api&&(null===(f=null===(v=i.evaluationContext)||void 0===v?void 0:v.environment)||void 0===f?void 0:f.apiKey)===(null===(p=this.evaluationContext.environment)||void 0===p?void 0:p.apiKey)&&(u=!0,this.evaluationContext.identity&&(null===(m=null===(y=i.evaluationContext)||void 0===y?void 0:y.identity)||void 0===m?void 0:m.identifier)!==this.evaluationContext.identity.identifier&&(this.log("Ignoring cache, identity has changed from "+(null===(C=null===(S=i.evaluationContext)||void 0===S?void 0:S.identity)||void 0===C?void 0:C.identifier)+" to "+this.evaluationContext.identity.identifier),u=!1),this.cacheOptions.ttl&&(!i.ts||(new Date).valueOf()-i.ts>this.cacheOptions.ttl)&&(i.ts&&!this.cacheOptions.loadStale?(this.log("Ignoring cache, timestamp is too old ts:"+i.ts+" ttl: "+this.cacheOptions.ttl+" time elapsed since cache: "+((new Date).valueOf()-i.ts)+"ms"),u=!1):i.ts&&this.cacheOptions.loadStale&&(this.log("Loading stale cache, timestamp ts:"+i.ts+" ttl: "+this.cacheOptions.ttl+" time elapsed since cache: "+((new Date).valueOf()-i.ts)+"ms"),s=!0,u=!0)),u&&(o=!0,t=l(this.flags,i.flags),this.setState(a(a({},i),{evaluationContext:d(a(a({},i.evaluationContext),{identity:(null===(_=i.evaluationContext)||void 0===_?void 0:_.identity)?a(a({},null===(b=i.evaluationContext)||void 0===b?void 0:b.identity),{traits:a({},N||{})}):void 0}))})),this.log("Retrieved flags from cache",i))),o?(c=!O&&(!this.cacheOptions.skipAPI||s),this._onChange(null,{isFromServer:!1,flagsChanged:t,traitsChanged:n},this._loadedState(null,g.CACHE,c)),this.oldFlags=this.flags,this.cacheOptions.skipAPI&&o&&!s&&this.log("Skipping API, using cache"),c&&this.getFlags().catch(function(t){var e;null===(e=w.onError)||void 0===e||e.call(w,t)}),[3,4]):[3,2];case 2:return O?[3,4]:[4,this.getFlags()];case 3:r.sent(),r.label=4;case 4:return[3,6];case 5:return h=r.sent(),this.log("Exception fetching cached logs",h),[3,6];case 6:return[3,10];case 7:return O?[3,9]:[4,this.getFlags()];case 8:return r.sent(),[3,10];case 9:if(E)this._onChange(null,{isFromServer:!1,flagsChanged:l({},this.flags),traitsChanged:l({},null===(x=this.evaluationContext.identity)||void 0===x?void 0:x.traits)},this._loadedState(null,g.DEFAULT_FLAGS));else{if(!this.flags)throw Error(J);this._onChange(null,{isFromServer:!1,flagsChanged:l({},this.flags),traitsChanged:l({},null===(F=this.evaluationContext.identity)||void 0===F?void 0:F.traits)},this._loadedState(null,g.DEFAULT_FLAGS))}r.label=10;case 10:return[2]}})})},X.label=2;case 2:return X.trys.push([2,7,,8]),m.getItemSync?(H=m.getItemSync(this.getStorageKey()),[3,5]):[3,3];case 3:return[4,m.getItem(this.getStorageKey())];case 4:H=X.sent(),X.label=5;case 5:return[4,M(null,H)];case 6:case 7:return X.sent(),[3,8];case 8:return[3,12];case 9:return O?[3,11]:[4,this.getFlags()];case 10:return X.sent(),[3,12];case 11:if(E)this._onChange(null,{isFromServer:!1,flagsChanged:l({},E),traitsChanged:l({},null===(e=s.identity)||void 0===e?void 0:e.traits)},this._loadedState(null,g.DEFAULT_FLAGS));else if(this.flags&&(V=null,0===Object.keys(this.flags).length&&(V=J),this._onChange(null,{isFromServer:!1,flagsChanged:l({},this.flags),traitsChanged:l({},null===(n=s.identity)||void 0===n?void 0:n.traits)},this._loadedState(V,g.DEFAULT_FLAGS)),V))throw Error(V);X.label=12;case 12:return[3,14];case 13:throw q=X.sent(),this.log("Error during initialisation ",q),B=q instanceof Error?q:Error("".concat(q)),null===(i=this.onError)||void 0===i||i.call(this,B),q;case 14:return[2]}})})},t.prototype.getAllFlags=function(){return this.flags},t.prototype.identify=function(t,e,n){return this.identity=t,this.evaluationContext.identity={identifier:t,transient:n,traits:this.evaluationContext.identity&&this.evaluationContext.identity.identifier==t?this.evaluationContext.identity.traits:{}},this.evaluationContext.identity.identifier=t,this.log("Identify: "+this.evaluationContext.identity.identifier),e&&(this.evaluationContext.identity.traits=Object.fromEntries(Object.entries(e).map(function(t){var e=t[0],n=t[1];return[e,c(n)?n:{value:n}]}))),this.initialised?this.getFlags():Promise.resolve()},t.prototype.getState=function(){return{api:this.api,flags:this.flags,ts:this.ts,evaluationContext:this.evaluationContext,identity:this.identity,evaluationEvent:this.evaluationEvent}},t.prototype.setState=function(t){var e,n;t&&(this.initialised=!0,this.api=t.api||this.api||C,this.flags=t.flags||this.flags,this.evaluationContext=t.evaluationContext||this.evaluationContext,this.evaluationEvent=t.evaluationEvent||this.evaluationEvent,this.identity=null===(n=null===(e=this.getContext())||void 0===e?void 0:e.identity)||void 0===n?void 0:n.identifier,this.log("setState called",this))},t.prototype.logout=function(){return this.identity=null,this.evaluationContext.identity=null,this.initialised?this.getFlags():Promise.resolve()},t.prototype.startListening=function(t){void 0===t&&(t=1e3),this.getFlagInterval&&clearInterval(this.getFlagInterval),this.getFlagInterval=setInterval(this.getFlags,t)},t.prototype.stopListening=function(){this.getFlagInterval&&(clearInterval(this.getFlagInterval),this.getFlagInterval=null)},t.prototype._loadedState=function(t,e,n){return void 0===t&&(t=null),void 0===n&&(n=!1),{error:t,isFetching:n,isLoading:!1,source:e}},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enableLogs&&console.log.apply(this,function(t,e,n){if(n||2==arguments.length)for(var i,a=0,o=e.length;a<o;a++)!i&&a in e||(i||(i=Array.prototype.slice.call(e,0,a)),i[a]=e[a]);return t.concat(i||Array.prototype.slice.call(e))}(["FLAGSMITH:",(new Date).valueOf()-(this.timer||0),"ms"],t,!0))},t.prototype.updateStorage=function(){if(this.cacheFlags){this.ts=(new Date).valueOf();var t=JSON.stringify(this.getState());this.log("Setting storage",t),m.setItem(this.getStorageKey(),t)}},t.prototype.updateEventStorage=function(){if(this.enableAnalytics){var t=JSON.stringify(this.getState().evaluationEvent);m.setItem(S,t).catch(function(t){return console.error("Flagsmith: Error setting item in async storage",t)})}},t.prototype.setLoadingState=function(t){var e;s(t,this.loadingState)||(this.loadingState=a({},t),this.log("Loading state changed",t),null===(e=this._triggerLoadingState)||void 0===e||e.call(this))},t.prototype.setupRealtime=function(t,e){var n=this,i=t+"sse/environments/"+e+"/stream";p?this.eventSource||(this.log("Creating event source with url "+i),this.eventSource=new p(i),this.eventSource.addEventListener("environment_updated",function(t){var e;try{e=JSON.parse(t.data).updated_at}catch(t){n.log("Could not parse sse event",t)}e?!n.timestamp||e>n.timestamp?n.isLoading?n.log("updated_at is new, but flags are loading",t.data,n.timestamp):(n.log("updated_at is new, fetching flags",t.data,n.timestamp),n.getFlags()):n.log("updated_at is outdated, skipping get flags",t.data,n.timestamp):n.log("No updated_at received, fetching flags",t)})):this.log("Error, EventSource is undefined")},t}(),b=(y=function(t,e){return(y=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),E=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},x=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,a,o=n.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)r.push(i.value)}catch(t){a={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return r},O=function(t,e,n){if(n||2==arguments.length)for(var i,a=0,o=e.length;a<o;a++)!i&&a in e||(i||(i=Array.prototype.slice.call(e,0,a)),i[a]=e[a]);return t.concat(i||Array.prototype.slice.call(e))},F=function(t){function e(){return t.call(this,"EventSource not available.\nConsider loading an EventSource polyfill and making it available globally as EventSource, or passing one in as eventSourceClass to the ReconnectingEventSource constructor.")||this}return b(e,t),e}(Error),w=function(){function t(t,e){var n=this;if(this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this._configuration=null!=e?Object.assign({},e):void 0,this.withCredentials=!1,this._eventSource=null,this._lastEventId=null,this._timer=null,this._listeners={open:[],error:[],message:[]},this.url=t.toString(),this.readyState=this.CONNECTING,this.max_retry_time=3e3,this.eventSourceClass=globalThis.FlagsmithEventSource,null!=this._configuration&&(this._configuration.lastEventId&&(this._lastEventId=this._configuration.lastEventId,delete this._configuration.lastEventId),this._configuration.max_retry_time&&(this.max_retry_time=this._configuration.max_retry_time,delete this._configuration.max_retry_time),this._configuration.eventSourceClass&&(this.eventSourceClass=this._configuration.eventSourceClass,delete this._configuration.eventSourceClass)),null==this.eventSourceClass||"function"!=typeof this.eventSourceClass)throw new F;this._onevent_wrapped=function(t){n._onevent(t)},this._start()}return t.prototype.dispatchEvent=function(t){throw Error("Method not implemented.")},t.prototype._start=function(){var t,e,n=this,i=this.url;this._lastEventId&&(-1===i.indexOf("?")?i+="?":i+="&",i+="lastEventId="+encodeURIComponent(this._lastEventId)),this._eventSource=new this.eventSourceClass(i,this._configuration),this._eventSource.onopen=function(t){n._onopen(t)},this._eventSource.onerror=function(t){n._onerror(t)},this._eventSource.onmessage=function(t){n.onmessage(t)};try{for(var a=E(Object.keys(this._listeners)),o=a.next();!o.done;o=a.next()){var r=o.value;this._eventSource.addEventListener(r,this._onevent_wrapped)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}},t.prototype._onopen=function(t){0===this.readyState&&(this.readyState=1,this.onopen(t))},t.prototype._onerror=function(t){var e=this;if(1===this.readyState&&(this.readyState=0,this.onerror(t)),this._eventSource){this._eventSource.close(),this._eventSource=null;var n=Math.round(this.max_retry_time*Math.random());this._timer=setTimeout(function(){return e._start()},n)}},t.prototype._onevent=function(t){t&&t.lastEventId&&(this._lastEventId=t.lastEventId);var e,n,i=this._listeners[t.type];if(null!=i)try{for(var a=E(O([],x(i),!1)),o=a.next();!o.done;o=a.next())o.value.call(this,t)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}"message"===t.type&&this.onmessage(t)},t.prototype.onopen=function(t){},t.prototype.onerror=function(t){},t.prototype.onmessage=function(t){},t.prototype.close=function(){this._timer&&(clearTimeout(this._timer),this._timer=null),this._eventSource&&(this._eventSource.close(),this._eventSource=null),this.readyState=2},t.prototype.addEventListener=function(t,e,n){null==this._listeners[t]&&(this._listeners[t]=[],null!=this._eventSource&&this._eventSource.addEventListener(t,this._onevent_wrapped));var i=this._listeners[t];i.includes(e)||(this._listeners[t]=O(O([],x(i),!1),[e],!1))},t.prototype.removeEventListener=function(t,e,n){var i=this._listeners[t];this._listeners[t]=i.filter(function(t){return t!==e})},t}();globalThis.FlagsmithEventSource="undefined"!=typeof EventSource?EventSource:null;var L=new _({fetch:(i={AsyncStorage:{getItemSync:function(t){try{return localStorage.getItem(t)||null}catch(t){return null}},getItem:function(t,e){var n=this;return new Promise(function(i,a){try{var o=n.getItemSync(t);null==e||e(null,o),i(o)}catch(t){e&&e(t,null),a(t)}})},setItem:function(t,e,n){return new Promise(function(i,a){try{localStorage.setItem(t,e),n&&n(null,e),i(e)}catch(t){n&&n(t,null),a(t)}})}},fetch:function(t,e){return e=e||{},new Promise(function(n,i){var a=new XMLHttpRequest,o=[],r=[],s={},l=function(){return{ok:2==(a.status/100|0),statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:l,headers:{keys:function(){return o},entries:function(){return r},get:function(t){return s[t.toLowerCase()]},has:function(t){return t.toLowerCase() in s}}}};for(var u in a.open(e.method||"get",t,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(t,e,n){o.push(e=e.toLowerCase()),r.push([e,n]),s[e]=s[e]?s[e]+","+n:n}),n(l())},a.onerror=i,a.withCredentials="include"==e.credentials,e.headers)a.setRequestHeader(u,e.headers[u]);a.send(e.body||null)})},eventSource:w}).fetch,AsyncStorage:i.AsyncStorage,eventSource:i.eventSource});"undefined"!=typeof window&&(window.flagsmith=L)}}]);